/*
 * Copyright 2018 FLIR
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License version 2 as
 * published by the Free Software Foundation.
 */

/dts-v1/;

#include "imx7ulp.dtsi"
#include <dt-bindings/input/input.h>

/ {
	model = "FLIR Low Cost Brassboard";
	compatible = "flir,imx7ulp-bblc", "fsl,imx7ulp", "Generic DT based system";

	aliases {
		gpio4 = &rpmsg_gpio0;
		gpio5 = &rpmsg_gpio1;
	};

	chosen {
		stdout-path = &lpuart4;
	};

	memory {
		device_type = "memory";
		reg = <0x60000000 0x20000000>;
	};

	backlight {
		compatible = "pwm-backlight";
		pwms = <&pwm1 1 50000>;
		brightness-levels = <0 10 20 30 40 50 60 70 80 90 100>;
		default-brightness-level = <7>;
		status = "okay";
	};

	mipi_dsi_reset: mipi-dsi-reset {
		compatible = "gpio-reset";
		reset-gpios = <&gpio_ptc 19 GPIO_ACTIVE_LOW>;	// Dummy GPIO, not used
		reset-delay-us = <1000>;
		#reset-cells = <0>;
	};

	emmc_reset: emmc_reset {
		compatible = "gpio-reset";
		reset-gpios =  <&gpio_ptd 0 GPIO_ACTIVE_LOW>;
		reset-delay-us = <1000>;
		#reset-cells = <0>;
	};
			
	regulators {
		compatible = "simple-bus";
		#address-cells = <1>;
		#size-cells = <0>;
		
		dummy_reg: dummy_reg {
			compatible = "regulator-fixed";
			regulator-name = "dummy_reg";
			regulator-min-microvolt = <600000>;
			regulator-max-microvolt = <1387500>;
			regulator-boot-on;
			regulator-always-on;
		};
	
	};
	
	extcon_usb1: extcon_usb1 {
		compatible = "linux,extcon-usb-gpio";
		id-gpio = <&gpio_ptc 13 GPIO_ACTIVE_HIGH>;
		pinctrl-names = "default", "sleep";
		pinctrl-0 = <&pinctrl_extcon_usb1>;
		pinctrl-1 = <&pinctrl_extcon_usb1>;
	};

	rpmsg_gpio0: rpmsg-gpio0 {
		compatible = "fsl,imx-rpmsg-gpio";
		port_idx = <0>;
		gpio-controller;
		#gpio-cells = <2>;
		#interrupt-cells = <2>;
		interrupt-controller;
		interrupt-parent = <&rpmsg_gpio0>;
		status = "disabled";
	};

	rpmsg_gpio1: rpmsg-gpio1 {
		compatible = "fsl,imx-rpmsg-gpio";
		port_idx = <1>;
		gpio-controller;
		#gpio-cells = <2>;
		#interrupt-cells = <2>;
		interrupt-controller;
		interrupt-parent = <&rpmsg_gpio1>;
		status = "disabled";
	};

	v4l2_cap_0 {
		compatible = "fsl,imx7-rpmsg-capture";
 		status = "disabled";
	};
	
	// We use another PWM than evalkit - TPM5 channel 1
	pwm1: tpm@40260000 {
		compatible = "nxp,tpm-pwm";
		reg = <0x40260000 0x1000>;
		nxp,pwm-number = <2>;
		assigned-clocks = <&clks IMX7ULP_CLK_LPTPM5>;
		assigned-clock-parents = <&clks IMX7ULP_CLK_SOSC_BUS_CLK>;
		clocks = <&clks IMX7ULP_CLK_LPTPM5>;
		#pwm-cells = <2>;
		pinctrl-names = "default", "sleep";
		pinctrl-0 = <&pinctrl_pwm1>;
		pinctrl-1 = <&pinctrl_pwm1>;
	};
	
	// Set up new system timer as TPM5 is used by PWM
	tpm6: tpm@40A10000 {
		compatible = "fsl,imx7ulp-tpm";
		reg = <0x40A10000 0x1000>;
		interrupts = <GIC_SPI 23 IRQ_TYPE_LEVEL_HIGH>;
		clocks = <&clks IMX7ULP_CLK_LPTPM6>,
			 <&clks IMX7ULP_CLK_NIC1_BUS_DIV>;
		clock-names = "per", "ipg";
	};
};
	
&cpu0 {
	arm-supply= <&dummy_reg>;
};

// Disable TPM5 as it is used by PWM - we use TPM6 instead
&tpm5 {
	status = "disabled";
};

// Change system clock from TPM5 to TPM6
&clks {
	assigned-clocks = <&clks IMX7ULP_CLK_LPTPM6>;
};

&iomuxc1 {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_hog_1>;

	imx7ulp-evk {
		pinctrl_hog_1: hoggrp-1 {
			fsl,pins = <
				IMX7ULP_PAD_PTC1__PTC1	0x3	 //SHUTTER_OUT
			>;
		};

		pinctrl_pwm1: pwm1_grp {
			fsl,pins = <
				IMX7ULP_PAD_PTC7__TPM5_CH1	0x3
			>;
		};

		pinctrl_lpi2c5: lpi2c5grp {
			fsl,pins = <
				IMX7ULP_PAD_PTC4__LPI2C5_SCL       0x27
				IMX7ULP_PAD_PTC5__LPI2C5_SDA       0x27
			>;
		};
		
		pinctrl_lpi2c6: lpi2c6grp {
			fsl,pins = <
				IMX7ULP_PAD_PTE8__LPI2C6_SCL	0x27
				IMX7ULP_PAD_PTE9__LPI2C6_SDA	0x27
			>;
		};
		
		pinctrl_lpi2c7: lpi2c7grp {
			fsl,pins = <
				IMX7ULP_PAD_PTE12__LPI2C7_SCL	0x27
				IMX7ULP_PAD_PTF13__LPI2C7_SDA	0x27
			>;
		};
		
		pinctrl_lpuart4: lpuart4grp {
			fsl,pins = <
				IMX7ULP_PAD_PTC3__LPUART4_RX	0x3
				IMX7ULP_PAD_PTC2__LPUART4_TX	0x3
			>;
		};

		pinctrl_lpuart6: lpuart6grp {
			fsl,pins = <
				IMX7ULP_PAD_PTE10__LPUART6_TX	0x3
				IMX7ULP_PAD_PTE11__LPUART6_RX	0x3
				IMX7ULP_PAD_PTE9__LPUART6_RTS_B	0x3
				IMX7ULP_PAD_PTE8__LPUART6_CTS_B	0x3
			>;
		};

		pinctrl_usdhc0: usdhc0grp {
			fsl,pins = <
				IMX7ULP_PAD_PTD0__PTD0		0x20000		/* USDHC0 RST */
				IMX7ULP_PAD_PTD1__SDHC0_CMD	0x43
				IMX7ULP_PAD_PTD2__SDHC0_CLK	0x10042
				IMX7ULP_PAD_PTD3__SDHC0_D7	0x43
				IMX7ULP_PAD_PTD4__SDHC0_D6	0x43
				IMX7ULP_PAD_PTD5__SDHC0_D5	0x43
				IMX7ULP_PAD_PTD6__SDHC0_D4	0x43
				IMX7ULP_PAD_PTD7__SDHC0_D3	0x43
				IMX7ULP_PAD_PTD8__SDHC0_D2	0x43
				IMX7ULP_PAD_PTD9__SDHC0_D1	0x43
				IMX7ULP_PAD_PTD10__SDHC0_D0	0x43
				IMX7ULP_PAD_PTD11__SDHC0_DQS	0x42
			>;
		};

		pinctrl_usdhc1: usdhc1grp {
			fsl,pins = <
				IMX7ULP_PAD_PTE3__SDHC1_CMD		0x43
				IMX7ULP_PAD_PTE2__SDHC1_CLK		0x10042
				IMX7ULP_PAD_PTE1__SDHC1_D0		0x43
				IMX7ULP_PAD_PTE0__SDHC1_D1		0x43
				IMX7ULP_PAD_PTE5__SDHC1_D2		0x43
				IMX7ULP_PAD_PTE4__SDHC1_D3		0x43
			>;
		};
		
		pinctrl_extcon_usb1: extcon1grp {
			fsl,pins = <
				IMX7ULP_PAD_PTC13__PTC13	0x10003
			>;
		};
		
		pinctrl_mipi_dsi_reset: mipi_dsi_reset_grp {
			fsl,pins = <
				IMX7ULP_PAD_PTC19__PTC19	0x3	// Dummy
			>;
		};

	};
};

/* LCD */
&mipi_dsi {
	pinctrl-names = "default", "sleep";
	pinctrl-0 = <&pinctrl_mipi_dsi_reset>;
	pinctrl-1 = <&pinctrl_mipi_dsi_reset>;
	lcd_panel = "ORISE-VGA";
	status = "okay";
	resets = <&mipi_dsi_reset>;
};

&lcdif {
	status = "okay";
	disp-dev = "mipi_dsi_northwest";
	display = <&display0>;

	display0: display@0 {
		bits-per-pixel = <32>;
		bus-width = <24>;
	};
};

/* Touch screen */
&lpi2c7 {
	#address-cells = <1>;
	#size-cells = <0>;
	pinctrl-names = "default",  "sleep";
	pinctrl-0 = <&pinctrl_lpi2c7>;
	pinctrl-1 = <&pinctrl_lpi2c7>;
	status = "okay";

};
	
/*  IO expander for keyboard, VCAM, Lepton, Temp sensor 1 and 2, EEPROM	*/
&lpi2c6 {
#address-cells = <1>;
#size-cells = <0>;
	pinctrl-names = "default", "sleep";
	pinctrl-0 = <&pinctrl_lpi2c6>;
	pinctrl-1 = <&pinctrl_lpi2c6>;
	status = "okay";
	
};
	
/*  PMIC */
&lpi2c5 {
	#address-cells = <1>;
	#size-cells = <0>;
	pinctrl-names = "default", "sleep";
	pinctrl-0 = <&pinctrl_lpi2c5>;
	pinctrl-1 = <&pinctrl_lpi2c5>;
	status = "okay";
};

&lpuart4 { /* console */
	pinctrl-names = "default", "sleep";
	pinctrl-0 = <&pinctrl_lpuart4>;
	pinctrl-1 = <&pinctrl_lpuart4>;
	status = "okay";
};

&lpuart6 { /* BT */
	pinctrl-names = "default", "sleep";
	pinctrl-0 = <&pinctrl_lpuart6>;
	pinctrl-1 = <&pinctrl_lpuart6>;
	status = "okay";
};

&rpmsg{
	/*
	 * 64K for one rpmsg instance, default using 2 rpmsg instances:
	 * --0x9FF00000~0x9FF0FFFF: pmic,pm,audio,keys,gpio,sensor
	 * --0x9FF10000~0x9FF1FFFF: pingpong,virtual tty
	 */
	vdev-nums = <2>;
	reg = <0x9FF00000 0x20000>;
	status = "disabled";
};

&usbotg1 {
	extcon = <0>, <&extcon_usb1>;
	srp-disable;
	hnp-disable;
	adp-disable;
	status = "okay";
};

/* emmc */
&usdhc0 {
	pinctrl-names = "default", "sleep";
	pinctrl-0 = <&pinctrl_usdhc1>;
	pinctrl-1 = <&pinctrl_usdhc1>;
	bus-width = <8>;
	no-1-8-v;
	resets = <&emmc_reset>;
	pm-ignore-notify;
	keep-power-in-suspend;
	non-removable;
	status = "okay";
};

/* wifi */
&usdhc1 {
	pinctrl-names = "default", "sleep";
	pinctrl-0 = <&pinctrl_usdhc0>;
	pinctrl-1 = <&pinctrl_usdhc0>;
	status = "okay";
};
